# TPO Analysis — v9.2a (merged v9.1.6 + v9.2)

**Purpose**: Superset of v9.1.6 + v9.2 without regressions. Compute a cutoff‑aware TPO read for ES/NQ/YM (or provided symbols) and output strict JSON, a human report, and CSV artifacts. Treat tz‑naive CSV timestamps as **US/Eastern** (no conversion).

## Inputs
- `session_date` (e.g., 2025-09-26)
- `session_type`: `RTH` (default) or `ETH`
- `pretend_cutoff`: `HH:MM` ET (e.g., 14:00)
- CSVs (NinjaDataExport/v1): paths per symbol
- Tick sizes: ES=0.25, NQ=0.25, YM=1.0

**CSV schema**: locate header row `timestamp, instrument, period, open, high, low, close, volume, ...`; parse `timestamp` → `_dt` (tz‑naive, US/Eastern). Use `open/high/low/close/volume`.

## Computations
1) **Session slice**: RTH 09:30 → `pretend_cutoff` (or ETH variant).
2) **TPO**:
   - 30‑min brackets → letters `A..` (extend `A27` etc. if needed)
   - Ladder uses instrument tick size
   - Count one print per price per bracket (unique letter presence)
   - **POC** = price with max unique letters
   - **70% VA**: expand from POC to ≥70% total TPOs
   - **IB**: first 2 brackets (A+B) H/L (or A only if needed)
3) **Singles / tails**: contiguous Count==1 at extremes; report up/down bands.
4) **Poor extremes**: top/bottom extreme has Count>1.
5) **Day‑type**: P/b/B/D via tails + weight left/right of POC.
6) **IB extension & acceptance**:
   - Side Up/Down; points; % of IB.
   - **Acceptance** if extension ≥25% IB **and** held (≥60% closes beyond boundary or last close beyond).
7) **VA skew**: POC in VA thirds: `lower/middle/upper`.
8) **HVN/LVN nodes**: local maxima/minima of TPO count (top 3–5 each).
9) **Gap** vs prior RTH close:
   - Points (open − prior close), direction up/down/flat
   - If closed by cutoff, first time the prior close was traded.

## Outputs
- **JSON (strict)**: ib, value_area (val/poc/vah + `poc_position`), range, singles, poor_extremes, day_type, ib_extension (+ `ib_acceptance`), gap (with `gap_close_time_et`), nodes, key_levels, short comments.
- **Human report (md)**: Session, IB (height), VA + skew, Range, IB Extension (+ acceptance), Day Type, Poor High/Low, Singles, **Gap** line, brief context read.
- **CSV artifacts**:
  - `SYMBOL_TPO_Profile_{date}_0930_to_{cutoff}.csv` (ladder)
  - `SYMBOL_Raw_{date}_0930_to_{cutoff}.csv` (audit slice)

## Quality
- Pretend cutoff governs *all* calculations & filenames.
- Use unique‑letter counts for VA/POC.
- Error clearly if no RTH data to cutoff.
