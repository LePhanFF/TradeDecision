# TPO ANALYSIS — v9.4.10 (FULL • STANDALONE • EMBEDDED PLAYBOOK)
Generated: 2025-09-30 00:16

This is a **single-file prompt**. It contains:
- The **complete analysis instructions/output contract**.
- An **embedded YAML playbook + engine/spec** (used during analysis; *no external files required*).
- The **JSON draw-plan schema** and **alert IDs** for the NinjaTrader add‑on.

---

## How to use this prompt
Paste this entire file as your prompt. Your analyzer should parse the YAML block below (between the PLAYBOOK markers)
and use those settings/rules during computation and rendering.

---

## Confirmation & Cadence
- You can run this **any time**. A 15‑minute cadence is suggested only because our rules use 5‑minute bars
  (2 bars ≈ 10 minutes) for acceptance and morph confirmation.

---

## Embedded Playbook YAML (parse + use this during analysis)
--- PLAYBOOK_YAML_START ---
version: v9.4.10
last_updated: 2025-09-30 00:16
single_file: true
prompt_embedded:
  note: This YAML is embedded into the FULL PROMPT; analyzer should parse and use it.
engine_spec:
  rth:
    start: 09:30
    end: '16:00'
    timezone: US/Eastern
  ib:
    bars: 6
    bar_interval_minutes: 5
  volume_profile:
    method: close_weighted_histogram
    tick_size_map:
      NQ: 0.25
      ES: 0.25
      YM: 1.0
    value_area_percent: 70
    hvn_lvn_detection:
      prominence_ratio: 0.6
  b_day_acceptance_metrics:
    compute_time_bars: true
    regions:
    - lower_node
    - between_nodes
    - upper_node
  gap_logic:
    types:
    - gap_and_go
    - partial_fill_balance
    - full_gap_fill
    - orr_gap_fill
    prior_close_ref: true
  peer_gap_summary:
    indices:
    - ES
    - NQ
    - YM
    report: true
  day_type_classification:
    Balance_Day:
      centered_poc: true
      ib_contains_majority: true
    P_Day:
      poc_lower_half_va: true
      skew: up
    b_Day:
      poc_upper_half_va: true
      skew: down
    B_Day:
      min_nodes: 2
      seam_required: true
      va_separation_ratio_min: 0.2
    Trend_Day:
      ib_break_hold: true
      single_prints_persist: true
      one_timeframing_30m_min: 3
    Double_Distribution_Trend:
      trend_morning: true
      mid_pause_node: true
      pm_break_in_trend: true
    Neutral_Day:
      ib_both_sides: true
ui:
  auto_display_on_run: true
  display_order:
  - Levels
  - DayType
  - Playbook
  - Overlays
  - Gaps
  - MorphLog
  - DrawPlan
  - PeerNotes
  show_levels_table: true
  show_nodes_table: true
  show_entry_exit_examples: true
  show_drawplan_json: true
  show_peer_indices_note: true
  show_morph_log: true
  show_at_open: true
  show_after_morph_confirmed: true
  cadence_minutes: 15
playbooks:
  Balance_Day:
    aliases:
    - D_Day
    - Balance
    detection:
      centered_poc: true
      symmetric_rotations: true
      ib_contains_majority: true
      normal_subtype_rule: DayRange <= 1.1 * IBRange
    setups:
    - name: VAH_Fade
      side: short
      trigger: "Poke VAH then 1\u20132 bar fail-back"
      stop: Beyond failure wick
      targets:
      - POC
      - VAL
    - name: VAL_Fade
      side: long
      trigger: "Poke VAL then 1\u20132 bar fail-back"
      stop: Beyond failure wick
      targets:
      - POC
      - VAH
    execution_checklist:
    - Fade VA edges on rejection; structure stops; T1 POC; T2 opposite edge if range persists
    morphs:
      to_trend: Acceptance + time outside VA
      to_B: Two HVNs with LVN seam persist
  P_Day:
    detection:
      poc_position: lower_half_VA
      va_skew: up
      dominant_extension: IBH
    setups:
    - name: Upper_Edge_Fade
      side: short
      where: VAH/IBH/upper HVN
      trigger: Poke then fail-back <=2 bars
      stop: Beyond failure wick
      targets:
      - POC
      - VAL
    - name: Acceptance_Continuation
      side: long
      where: Above VAH/upper node
      trigger: '>=2 closes above VAH + dPOC up'
      entry: Pullback holds above
      stop: Back inside value
      targets:
      - IBH/upper_far_edge
      - MeasuredMove/next_node
    early_invalidation_vwap:
      first_test: healthy >=0.5 swing
      second_test_warning: bounce <0.3 swing
      failure: "close<VWAP & <last_swing \u21D2 morph B/TrendDown"
  b_Day:
    detection:
      poc_position: upper_half_VA
      va_skew: down
      dominant_extension: IBL
    setups:
    - name: Lower_Edge_Fade
      side: long
      where: VAL/IBL/lower HVN
      trigger: Poke then fail-back <=2 bars
      stop: Beyond failure wick
      targets:
      - POC
      - VAH
    - name: Acceptance_Continuation
      side: short
      where: Below VAL/lower node
      trigger: '>=2 closes below VAL + dPOC down'
      entry: Pullback fails below
      stop: Back inside value
      targets:
      - IBL/lower_far_edge
      - MeasuredMove/next_node
    early_invalidation_vwap:
      warning: "close>VWAP & >last_swing \u21D2 warning"
      failure: ">=2 closes >VWAP & >POC + dPOC_up \u21D2 morph B/TrendUp"
  B_Day:
    detection:
      node_count_min: 2
      hvn_separation_ratio_min: 0.2
      needs_lvn_seam: true
      skew_bias_fallback: true
    setups:
    - name: Node_Edge_Fade
      side:
      - short
      - long
      where: Upper HVN/VAH/IBH (shorts); Lower HVN/VAL/IBL (longs)
      trigger: Poke then fail-back <=2 bars
      stop: Beyond failure wick
      targets:
      - POC_or_seam
      - Opposite_Node_Edge
    - name: POC_Fail_Back
      side:
      - short
      - long
      where: Around POC after wrong-side test
      trigger: Acceptance attempt fails; snap back through POC
      stop: Beyond rejection swing
      targets:
      - seam
      - Opposite_Node_Edge
    - name: Seam_LVN_Rejection
      side:
      - short
      - long
      where: LVN seam
      trigger: Attempt to cross seam rejects
      stop: Beyond seam rejection wick
      targets:
      - near_node_edge
      - far_node_edge
    morphs:
      to_trend: Seam breaks + acceptance + dPOC migration
      to_balance: Seam fills (>=2 traversals & time_in_seam>=0.2)
    report_metrics:
      b_acceptance_bars:
      - time_lower_bars
      - time_between_bars
      - time_upper_bars
  Trend_Day:
    detection:
      ib_break_holds: true
      single_prints_persist: true
      one_timeframing_30m: '>=3 bars'
      dpoc_migrates_with_move: true
      vwap_touches: 0-1
    setups:
    - name: IB_Break_Entry
      side:
      - long
      - short
      trigger: "First 5\u201315m close beyond IB edge"
      entry: With the break
      stop: Inside IB
      targets:
      - Range extension
      - Opposite 30m bar
    - name: Pullback_AddOn
      side:
      - long
      - short
      trigger: Shallow pullback into single prints/VWAP
      entry: Continuation
      stop: Beyond pullback swing
      targets:
      - Continuation until one-timeframing breaks
    invalidation:
    - Single prints fill quickly
    - 2 closes back inside IB
    - dPOC stops migrating
  Double_Distribution_Trend:
    id: DDT
    detection:
      trend_morning: true
      mid_pause_node: true
      pm_break_in_trend: true
    setups:
    - name: Morning_Trend_Entry
      trigger: IB breakout + one-timeframing
      entry: Breakout close or pullback to IB edge
      stop: Inside IB
      targets:
      - Initial extension
    - name: Afternoon_Continuation
      trigger: Break of pause-node seam in trend direction
      entry: Seam break close or pullback hold
      stop: Inside pause node
      targets:
      - Leg1_length projection
    invalidation:
    - PM breakout fails back into pause
    - dPOC anchors in pause
    morphs:
      to_balance: "Pause dominates \u2192 seam fills \u2192 Balance"
  Neutral_Day:
    detection:
      ib_high_broken: true
      ib_low_broken: true
      variant:
        neutral: close ~ mid
        neutral_extreme: close ~ extreme
    setups:
    - name: Neutral_Fade
      when: neutral
      entries:
      - "Short IBH excess \u2192 POC"
      - "Long IBL excess \u2192 POC"
    - name: Neutral_Extreme_Align
      when: neutral_extreme
      entries:
      - Long if close near high
      - Short if close near low
overlays:
  poor_extremes:
    poor_high_rule: '>=2 TPOs at high w/o tail'
    poor_low_rule: '>=2 TPOs at low w/o tail'
    states:
    - detected
    - repaired_same_day
    - carry_forward
  excess:
    rule: Tail >=2 prices at extreme
    trade: Trade away; use extreme as stop; carry-forward if unretested
vwap_usage_map:
  Trend_Day: integrity_filter_0_1
  Double_Distribution_Trend: integrity_filter_0_1
  P_Day: early_invalidation
  b_Day: early_invalidation
  B_Day: not_used
  Balance_Day: not_used
gap_playbook:
  gap_and_go:
    bias: Trend/DDT
  partial_fill_balance:
    bias: Balance
  full_gap_fill:
    bias: Gap fill magnet
  orr_gap_fill:
    bias: Gap fill magnet
alerts:
- id: ALERT_PDAY_VWAP_FAIL
  when: close<VWAP & close<last_swing
  message: "P failing \u2014 morph risk to B/TrendDown"
- id: ALERT_BDAY_SEAM_BREAK
  when: acceptance_beyond_seam & dPOC_migrate
  message: "B\u2192Trend risk"
- id: ALERT_BDAY_SEAM_FILL
  when: seam_crosses>=2 & time_in_seam>=0.2
  message: "B\u2192Balance (seam filling)"
- id: ALERT_NEUTRAL_EXTREME
  when: ib_high_broken & ib_low_broken & close_near_extreme
  message: "Neutral Extreme \u2014 continuation next session"
- id: ALERT_DDT_PAUSE_BREAK
  when: afternoon_break_in_trend & seam_confirmed
  message: DDT continuation
- id: ALERT_GAP_FULLFILL
  when: gap_open & open_failed & price_to_prior_close
  message: Gap fill magnet active
- id: ALERT_EXCESS_HIGH
  when: tail_length>=2 & location=high
  message: "Excess high \u2014 short bias back to POC"
- id: ALERT_EXCESS_LOW
  when: tail_length>=2 & location=low
  message: "Excess low \u2014 long bias back to POC"
- id: ALERT_POOR_HIGH
  when: flat_top_TPOs>=2
  message: "Poor High \u2014 repair watch"
- id: ALERT_POOR_LOW
  when: flat_bottom_TPOs>=2
  message: "Poor Low \u2014 repair watch"
json_schema:
  schema_version: '1.1'
  version: v9.4.10
  required:
  - vah
  - poc
  - val
  - ib_high
  - ib_low
  - hvn
  - lvn
  - zones
  - lines
  - targets

--- PLAYBOOK_YAML_END ---
