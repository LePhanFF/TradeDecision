# TPO ANALYSIS — v9.4.11 (FULL • STANDALONE • RESTORED PLAYBOOKS + ICT METRICS)
Generated: 2025-09-30 02:08

**Important:** This version restores the entire Playbooks section and includes ICT/Liquidity/FVG metrics.  
Dual‑IB config is enabled: **primary 60m** (Dalton standard) for classification, **preview 30m** for early alerts.

## Output Order
Levels → Metrics → Playbook → Day‑Type details → Overlays → Gaps → Morph Log → Draw‑Plan JSON → Peer Notes.

## Embedded YAML (parse + use)
--- PLAYBOOK_YAML_START ---
version: v9.4.11
last_updated: 2025-09-30 02:20
single_file: true
prompt_embedded:
  note: Use this YAML block; no external refs.
engine_spec:
  rth:
    start: 09:30
    end: '16:00'
    timezone: US/Eastern
  ib:
    primary_minutes: 60
    preview_minutes: 15
    bar_interval_minutes: 5
  volume_profile:
    method: close_weighted_histogram
    tick_size_map:
      NQ: 0.25
      ES: 0.25
      YM: 1.0
    value_area_percent: 70
    hvn_lvn_detection:
      prominence_ratio: 0.6
  b_day_acceptance_metrics:
    compute_time_bars: true
    regions:
    - lower_node
    - between_nodes
    - upper_node
  gap_logic:
    types:
    - gap_and_go
    - partial_fill_balance
    - full_gap_fill
    - orr_gap_fill
    prior_close_ref: true
  peer_gap_summary:
    indices:
    - ES
    - NQ
    - YM
    report: true
ui:
  auto_display_on_run: true
  display_order:
  - Levels
  - Metrics
  - DayType
  - Playbook
  - Overlays
  - Gaps
  - MorphLog
  - DrawPlan
  - PeerNotes
  show_levels_table: true
  show_nodes_table: true
  show_entry_exit_examples: true
  show_drawplan_json: true
  show_peer_indices_note: true
  show_morph_log: true
  show_at_open: true
  show_after_morph_confirmed: true
  cadence_minutes: 15
reporting:
  tables:
  - Levels
  - Metrics
  - Nodes
  - Liquidity_Pools
  - FVGs
  - ICT_Anchors
  - IB
  - Gaps
  - Peer_Gap_Summary
  - Overlays
  - Scoring
  - Morph_Log
  - Indicators
  metrics:
    session_meta:
    - session_date
    - rth_open
    - rth_high
    - rth_low
    - rth_close
    - rth_range_pts
    - rth_volume
    value_ib:
    - val
    - poc
    - vah
    - value_area_width
    - poc_position_pct_in_va
    - ib_high
    - ib_low
    - ib_range
    - ib_range_pct_of_day
    - ib_break_time
    - ib_reentry_count
    developing_poc:
    - dpoc_current
    - dpoc_direction
    - dpoc_shifts_count
    - dpoc_path_15m
    profile_nodes:
    - hvn_top3
    - lvn_up_to5
    - node_count
    - seam_price
    - seam_width
    - top2_separation_ratio
    b_day:
    - time_in_lower_node_bars
    - time_in_between_bars
    - time_in_upper_node_bars
    - seam_traversals
    - seam_acceptance
    - seam_fill_ratio
    - b_to_trend_time
    - b_to_balance_time
    vwap:
    - vwap_touches
    - first_touch_time
    - max_excursion_from_vwap
    - p_vwap_bounce1_retrace_pct
    - p_vwap_bounce2_retrace_pct
    - b_vwap_reclaim_time
    - b_vwap_closes_above_poc_count
    gaps:
    - gap_points
    - gap_direction
    - gap_percent_filled
    - gap_filled
    - gap_fill_time
    - gap_magnet_target
    peers:
    - peer_gap_filled_count
    - peer_summary
    accept_reject:
    - closes_above_vah_count
    - closes_below_val_count
    - seam_closes_beyond_count
    - one_timeframing_30m_count
    - hourly_directional_candles_count
    single_prints:
    - single_print_levels
    - single_prints_unrepaired_count
    - single_prints_filled_times
    overlays:
    - poor_high_detected
    - poor_high_repaired_time
    - poor_low_detected
    - poor_low_repaired_time
    - excess_high_detected
    - excess_low_detected
    - excess_tail_lengths
    ict_anchors:
    - london_high
    - london_low
    - prev_day_eth_high
    - prev_day_eth_low
    - weekly_high
    - weekly_low
    - weekly_open
    - weekly_open_gap_pts
    - monthly_high
    - monthly_low
    - monthly_open
    - quarterly_high
    - quarterly_low
    - quarterly_open
    - midnight_open
    - rth_open
    - pm_open_1430
    liquidity_pools_spec:
      sorted_by: "TF asc (5m\u219215m\u21921H\u21924H)"
      fields:
      - timeframe
      - type
      - price
      - touches
      - last_touch
      - taken_out
      - sweep_reject
      - reclaim_accept
      - overlaps.hvn
      - overlaps.lvn
      - overlaps.poc
      - tpo_prints
      - score
      - next_target
    fvgs_spec:
      timeframes:
      - 15m_last_24h
      - 90m_last_3d
      - 4H_last_1w
      - Daily_last_1w
      fields:
      - timeframe
      - start
      - end
      - low
      - high
      - status
      - rejection
      - inversion
      - overlaps.hvn
      - overlaps.lvn
      - overlaps.liquidity_pool
      - score
    indicators:
    - rsi_1m
    - rsi_5m
    - atr_1m
    - atr_5m
    scoring_breakdown:
    - structure_score
    - trigger_quality_score
    - confluence_score
    - flow_score
    - total_score
    - score_rationale
    alerts_fired:
    - alert_ids_fired_in_session_order
playbooks:
  Balance_Day:
    aliases:
    - D_Day
    - Balance
    detection:
      centered_poc: true
      symmetric_rotations: true
      ib_contains_majority: true
      normal_subtype_rule: DayRange <= 1.1 * IBRange
    setups:
    - name: VAH_Fade
      side: short
      trigger: "Poke VAH then 1\u20132 bar fail-back"
      stop: Beyond failure wick
      targets:
      - POC
      - VAL
    - name: VAL_Fade
      side: long
      trigger: "Poke VAL then 1\u20132 bar fail-back"
      stop: Beyond failure wick
      targets:
      - POC
      - VAH
    acceptance_vs_rejection:
      acceptance:
        bars_5m: 2
        tpo_letters: 4
      rejection:
        max_failback_bars: 2
    execution_checklist:
    - Confirm balance (centered POC, symmetric VA).
    - Fade VA edges only on fail-back; structure stop beyond wick.
    - Scale T1 at POC; rotate to opposite edge only if range persists.
    - Invalidate on acceptance outside VA (>=2 closes) or twin nodes (seam).
    targets:
    - POC
    - OppositeEdge
    morphs:
      to_trend: Acceptance + time outside VA
      to_B: Two HVNs with LVN seam persist
    invalidation:
    - '>=2 5m closes outside VA against fade'
    - Rapid dPOC migration to edge faded
  P_Day:
    detection:
      poc_position: lower_half_VA
      va_skew: up
      dominant_extension: IBH
    setups:
    - name: Upper_Edge_Fade
      side: short
      where: VAH/IBH/upper HVN
      trigger: Poke then fail-back <=2 bars
      stop: Beyond failure wick
      targets:
      - POC
      - VAL
    - name: Acceptance_Continuation
      side: long
      where: Above VAH/upper node
      trigger: '>=2 closes above VAH + dPOC up'
      entry: Pullback holds above edge
      stop: Back inside value
      targets:
      - IBH/upper_far_edge
      - MeasuredMove/next_node
    early_invalidation_vwap:
      first_test: healthy >=0.5 swing
      second_test_warning: bounce <0.3 swing
      failure: "close<VWAP & <last_swing \u21D2 morph risk to B/TrendDown"
    execution_checklist:
    - Prefer short fades at upper edge if rejection; else continuation long on acceptance above VAH with
      dPOC up.
    - Use VWAP tests as early invalidation of P hypothesis.
    morphs:
      to_B: Second HVN forms with seam; separation >=20% of VA width
      to_trend: Sustained acceptance/time above VAH + dPOC up
    invalidation:
    - '>=2 5m closes back above VAH (for shorts)'
    - Back inside value after continuation (for longs)
  b_Day:
    detection:
      poc_position: upper_half_VA
      va_skew: down
      dominant_extension: IBL
    setups:
    - name: Lower_Edge_Fade
      side: long
      where: VAL/IBL/lower HVN
      trigger: Poke then fail-back <=2 bars
      stop: Beyond failure wick
      targets:
      - POC
      - VAH
    - name: Acceptance_Continuation
      side: short
      where: Below VAL/lower node
      trigger: '>=2 closes below VAL + dPOC down'
      entry: Pullback fails below edge
      stop: Back inside value
      targets:
      - IBL/lower_far_edge
      - MeasuredMove/next_node
    early_invalidation_vwap:
      warning: "close>VWAP & >last_swing \u21D2 warning"
      failure: ">=2 closes >VWAP & >POC + dPOC_up \u21D2 morph risk to B/TrendUp"
    execution_checklist:
    - Prefer long fades at lower edge if rejection; else continuation short on acceptance below VAL with
      dPOC down.
    - Use VWAP reclaim/failure as early invalidation.
    morphs:
      to_B: Second HVN forms with seam; separation >=20% VA width
      to_trend: Sustained acceptance/time below VAL + dPOC down
    invalidation:
    - '>=2 5m closes back below VAL (for longs)'
    - Back inside value after continuation (for shorts)
  B_Day:
    detection:
      node_count_min: 2
      hvn_separation_ratio_min: 0.2
      needs_lvn_seam: true
      skew_bias_fallback: true
    setups:
    - name: Node_Edge_Fade
      side:
      - short
      - long
      where: Upper HVN/VAH/IBH for shorts; Lower HVN/VAL/IBL for longs
      trigger: Poke then fail-back <=2 bars
      stop: Beyond failure wick
      targets:
      - POC_or_seam
      - Opposite_Node_Edge
    - name: POC_Fail_Back
      side:
      - short
      - long
      where: Around POC after wrong-side test
      trigger: Acceptance attempt fails; snap back through POC
      stop: Beyond rejection swing
      targets:
      - seam
      - Opposite_Node_Edge
    - name: Seam_LVN_Rejection
      side:
      - short
      - long
      where: LVN seam
      trigger: Attempt to cross seam rejects (wick + close back)
      stop: Beyond seam rejection wick
      targets:
      - near_node_edge
      - far_node_edge
    execution_checklist:
    - Confirm two HVNs + LVN seam; record VAH/POC/VAL.
    - Fade node edges on rejection; stops beyond failure wick.
    - T1 seam/POC; T2 opposite node edge.
    - Switch to Trend rules on seam acceptance + dPOC migration.
    morphs:
      to_trend: Seam breaks with acceptance (>=2 closes) + dPOC migration
      to_balance: Seam fills (>=2 traversals & time_in_seam >= 0.2 of session)
    invalidation:
    - Seam acceptance against fade
    - dPOC shift against trade during setup
    report_metrics:
      b_acceptance_bars:
      - time_lower_bars
      - time_between_bars
      - time_upper_bars
  Trend_Day:
    detection:
      ib_break_holds: true
      single_prints_persist: true
      one_timeframing_30m: '>=3 bars'
      dpoc_migrates_with_move: true
      vwap_touches: 0-1
    setups:
    - name: IB_Break_Entry
      side:
      - long
      - short
      trigger: "First 5\u201315m close beyond IB edge"
      entry: With the break
      stop: Inside IB
      targets:
      - Range extension
      - First opposite 30m bar
    - name: Pullback_AddOn
      side:
      - long
      - short
      trigger: Shallow pullback into single prints or VWAP
      entry: Continuation
      stop: Beyond pullback swing
      targets:
      - Continuation until one-timeframing breaks
    execution_checklist:
    - Do not fade VA edges on Trend Day.
    - Go with IB break and add on shallow pullbacks.
    - "Trail under/over 5\u201315m swings; exit on first opposite 30m bar or single-print fills."
    invalidation:
    - Single prints fill quickly
    - '>=2 closes back inside IB'
    - dPOC stops migrating
  Double_Distribution_Trend:
    id: DDT
    detection:
      morning_trend_leg: true
      midday_pause_node: true
      afternoon_break_in_trend: true
    setups:
    - name: Morning_Trend_Entry
      trigger: IB breakout + one-timeframing
      entry: Breakout close or pullback to IB edge
      stop: Inside IB
      targets:
      - Initial extension
    - name: Afternoon_Continuation
      trigger: Break of pause-node seam in trend direction
      entry: Seam break close or pullback hold
      stop: Inside pause node
      targets:
      - Leg1_length projection
    invalidation:
    - Afternoon breakout fails back into pause node
    - dPOC anchors inside pause node
    morphs:
      to_balance: "Pause node dominates; seam fills \u2192 Balance"
  Neutral_Day:
    detection:
      ib_high_broken: true
      ib_low_broken: true
      variant:
        neutral: close ~ mid-range
        neutral_extreme: close ~ extreme
    setups:
    - name: Neutral_Fade
      when: neutral
      entries:
      - "Short IBH excess \u2192 POC"
      - "Long IBL excess \u2192 POC"
    - name: Neutral_Extreme_Align
      when: neutral_extreme
      entries:
      - Align long if close near high
      - Align short if close near low
    invalidation:
    - Only one IB side broken
    - "Close reverts to mid after near-extreme \u2014 downgrade to Neutral classic"
overlays:
  poor_extremes:
    poor_high_rule: '>=2 TPOs at high w/o tail'
    poor_low_rule: '>=2 TPOs at low w/o tail'
    states:
    - detected
    - repaired_same_day
    - carry_forward
  excess:
    rule: Tail >=2 prices at extreme
    trade: Trade away; use extreme as stop; carry-forward if unretested
vwap_usage_map:
  Trend_Day: integrity_filter_0_1
  Double_Distribution_Trend: integrity_filter_0_1
  P_Day: early_invalidation
  b_Day: early_invalidation
  B_Day: not_used
  Balance_Day: not_used
gap_playbook:
  gap_and_go:
    bias: Trend/DDT
  partial_fill_balance:
    bias: Balance
  full_gap_fill:
    bias: Gap fill magnet
  orr_gap_fill:
    bias: Gap fill magnet
liquidity_pool_scoring:
  rules:
    hvn_overlap: 1
    lvn_overlap: 1
    poc_overlap: 1
    multi_touch: 1
    tpo_prints_gte_5: 1
    sweep_reject_bonus: 1
  thresholds:
    high_priority: 3
fvg_scoring:
  rules:
    rejection_mid: 1
    rejection_shallow: 1
    overlap_hvn: 1
    overlap_lvn: 1
    overlap_liquidity_pool: 1
    inversion_penalty: -1
  thresholds:
    strong: 3
alerts:
- id: ALERT_PDAY_VWAP_FAIL
  when: close<VWAP & close<last_swing
  message: "P failing \u2014 morph risk to B/TrendDown"
- id: ALERT_BDAY_SEAM_BREAK
  when: acceptance_beyond_seam & dPOC_migrate
  message: "B\u2192Trend risk"
- id: ALERT_BDAY_SEAM_FILL
  when: seam_crosses>=2 & time_in_seam>=0.2
  message: "B\u2192Balance (seam filling)"
- id: ALERT_NEUTRAL_EXTREME
  when: ib_high_broken & ib_low_broken & close_near_extreme
  message: "Neutral Extreme \u2014 continuation next session"
- id: ALERT_DDT_PAUSE_BREAK
  when: afternoon_break_in_trend & seam_confirmed
  message: DDT continuation
- id: ALERT_GAP_FULLFILL
  when: gap_open & open_failed & price_to_prior_close
  message: Gap fill magnet active
- id: ALERT_EXCESS_HIGH
  when: tail_length>=2 & location=high
  message: "Excess high \u2014 short bias back to POC"
- id: ALERT_EXCESS_LOW
  when: tail_length>=2 & location=low
  message: "Excess low \u2014 long bias back to POC"
- id: ALERT_POOR_HIGH
  when: flat_top_TPOs>=2
  message: "Poor High \u2014 repair watch"
- id: ALERT_POOR_LOW
  when: flat_bottom_TPOs>=2
  message: "Poor Low \u2014 repair watch"
- id: ALERT_POOL_SWEEP_REJECT
  when: liquidity_taken & reject_back_inside
  message: "Liquidity pool swept & rejected \u2014 reversal setup"
- id: ALERT_POOL_RECLAIM_ACCEPT
  when: liquidity_taken & closes_beyond>=2 & dpoc_migrates
  message: "Liquidity reclaimed \u2014 continuation to next pool/node"
- id: ALERT_FVG_REJECT_MID
  when: fvg_tag & reject_at_mid
  message: "FVG mid rejection \u2014 strong reaction"
- id: ALERT_FVG_INVERTED
  when: fvg_inversion_detected
  message: "FVG inverted to S/R \u2014 continuation bias"
json_schema:
  schema_version: '1.2'
  version: v9.4.11
  required:
  - vah
  - poc
  - val
  - ib_high
  - ib_low
  - hvn
  - lvn
  - zones
  - lines
  - targets
  optional:
  - liquidity_pools
  - fvgs
  - ict_anchors
  - indicators
regression_guards:
  since_versions:
  - v9.4.4
  - v9.4.5
  - v9.4.6
  - v9.4.7
  - v9.4.8
  - v9.4.9
  - v9.4.10
  - v9.4.11
  must_include:
  - Full Playbooks section
  - HVN/LVN arrays
  - dPOC path (15m)
  - B acceptance bars
  - Seam width/traversals
  - Peer gap summary
  - VWAP touches & P/b invalidation
  - Gaps (Gap&Go/Partial/Full/ORR)
  - Poor/Excess overlays
  - Liquidity Pools table + JSON (with sweep/reclaim)
  - FVGs table + JSON (with rejection/inversion)
  - ICT anchors
  - Scoring breakdown
  - Morph log timeline
  - Indicators (RSI/ATR)
  - acceptance_rules
  - version
  - last_updated
  - single_file
  - prompt_embedded
  - engine_spec
  - ui
  - playbooks
  - overlays
  - vwap_usage_map
  - gap_playbook
  - reporting
  - reporting.tables
  - reporting.metrics
  - vah
  - poc
  - val
  - ib_high
  - ib_low
  - hvn
  - lvn
  - Seam width & traversals
  - IB metrics
  - Single prints status
  - ict_anchors
  - liquidity_pools
  - liquidity_pool_scoring
  - fvgs
  - fvg_scoring
  - scoring_breakdown
  - alerts_fired
  - alerts
  - json_schema
  - regression_guards
  contract_hash: 651c4f40f95f46a7
acceptance_rules:
  primary:
    tpo_brackets_beyond_edge: 1
    description: '>= 1 x 30m TPO beyond IB edge (Dalton)'
  preview:
    minutes_close_beyond_edge: 15
    description: '>= 1 x 15m close beyond IB edge (early signal)'
  proxy:
    five_minute_closes: 2
    description: '>= 2 x 5m closes beyond level (alternative proxy)'

--- PLAYBOOK_YAML_END ---
