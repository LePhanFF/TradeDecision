# 📌 Prompt — Multi-Account DCA AddOn (NinjaTrader 8)

You are building a **NinjaTrader 8 AddOn** named **MultiAccountDCAAddOn**.
This AddOn manages **Dollar Cost Averaging (DCA) entries across multiple accounts** with strong **risk management, account grouping, and ATM integration**.

---

## 1. **Core Requirements**

* Runs as a **dockable AddOn tab** in NinjaTrader 8 Control Center.
* **UI-driven**: Account selection, filters, spacing, deployment, status, and fail-safes.
* **Hybrid execution model**:

  * AddOn decides *when* and *how* to enter trades.
  * Selected **ATM strategy templates** manage stops, targets, and trailing after entry.

---

## 2. **UI Layout**

### Left Panel

* **Available Accounts** (lowest balance first).
* Only shows accounts that:

  * Belong to the selected **Size Group**.
  * Are below **Risk Cap** (e.g., < $500 realized).
  * Have not hit **Max Daily Loss**.
  * Are not already in another AddOn tab (reserved).
* Button: **Add →** moves account to Selected.

### Right Panel

* **Status Indicator**:

  * 🟩 Green = active (positions/orders present).
  * 🟥 Red = inactive (all flat, no monitoring).

* **Filters Row**:

  * **Size Group dropdown**: $48k, $95k, $145k, $200k, $280k (±2%).
  * **Risk Cap ($)** input (default $500).
  * **Max Daily Loss ($)** input (default $1000).
  * **Instrument Selector**.

* **Spacing Controls**:

  * Mode: **Fixed Ticks** or **ATR × Multiplier**.
  * **Fixed Spacing (ticks)** input (default 12).
  * **ATR Multiplier** dropdown (0.5, 0.75, 1, 1.5, 2).
  * **Manual ATR (pts)** input (until live ATR is wired).
  * Display of **Effective Spacing (ticks)**.

* **Deployment Controls**:

  * **Direction**: Long / Short.
  * **Anchor Price** input.
  * **Max Rungs** input (default 6).
  * **Qty / Rung** input (default 1).
  * Button: **Start DCA (Auto Deploy)**.

* **Selected Accounts Panel**:

  * Each account row shows:

    * Name, Balance, Realized/Unrealized/Total PnL (color-coded).
    * **ATM dropdown** (choose saved template).
    * **ATR Start Offset** dropdown (0, 0.25, 0.5, 1.0).
    * Buttons: ↑ ↓ Remove.

* **Fail-safe Buttons**:

  * **Close All (Selected)** → flattens positions in selected accounts.
  * **Abort DCA** → cancels pending orders, stops new entries.

* **Protected Accounts Panel**:

  * Accounts excluded because:

    * Realized ≥ Risk Cap.
    * Realized ≤ -Max Daily Loss.
    * Out of size group.
  * Greyed out rows: Name, Balance, Net Realized, Status (“Flat” / “Active”), Reason.
  * **Flatten Protected** button.

* **Negative Accounts Panel**:

  * Accounts with `Realized < 0`.
  * Shows each with Balance and Realized.
  * Displays **Total Negative Realized**.

* **Footer Totals**:

  * Total Cash, Total Realized, Total Unrealized, Net PnL across Selected accounts.
  * All values color-coded (green profit, red loss).

---

## 3. **Execution Logic**

* **Account 1 (priority 1)**:

  * Places ladder at **Anchor Price**, spacing by chosen mode (ticks or ATR).
* **Account 2 (priority 2)**:

  * Starts at Anchor ± (0.25–1.0 ATR) offset.
* **Account 3 (priority 3)**:

  * Starts at Anchor ± (0.25–1.0 ATR) offset.
* All rungs placed as **limit orders** via `Account.CreateAtmStrategy()`.
* Ladder size = **Max Rungs × Qty per rung**.

---

## 4. **Risk Management**

* **Global Risk Cap (default $500)**:

  * If Realized ≥ cap and account is flat → remove to Protected.
* **Max Daily Loss (default $1000)**:

  * If Realized ≤ -max → flatten and remove to Protected.
  * If portfolio sum ≤ -max → abort all and flatten.
* **Size Group Enforcement**:

  * Only accounts within chosen size group can trade.
  * Out-of-group accounts moved to Protected.
* **Reservation**:

  * Account cannot be used in multiple AddOns simultaneously.

---

## 5. **Fail-safes**

* **Close All**: Flattens all positions in selected accounts.
* **Abort DCA**: Cancels working orders, halts new entries.
* **Flatten Protected**: Flattens all protected accounts.
* **Status Box**: Green if any orders/positions active, red otherwise.

---

## 6. **Color Coding**

* Green = profit.
* Red = loss.
* Grey = protected account row.
* Totals bold and colored by net sign.

---

## 7. **Future Enhancements**

* Replace manual ATR with **live 1-minute ATR** feed.
* Per-account configurable Risk Cap / Max Loss.
* Sparkline history of PnL per account.
* Logging of state changes (Available → Selected → Protected).

---

## 🎯 Goal

Deliver a **safe, automated DCA manager** for NinjaTrader 8 that:

* Deploys rungs sequentially across accounts automatically.
* Uses ATM strategies for exit logic.
* Protects profitable accounts (RiskCap) and limits drawdown (MaxLoss).
* Enforces account size grouping.
* Gives clear real-time visibility and strong fail-safes.


